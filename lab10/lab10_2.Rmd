---
title: "Lab 10.2"
output:
  html_document:
    theme: spacelab
    toc: yes
    toc_float: yes
  pdf_document:
    toc: yes
---

## Learning Goals
*At the end of this exercise, you will be able to:*    
1. Build stacked bar plots of categorical variables.  
2. Build side-by-side barplots using `position= "dodge"`.  

## Load the libraries
```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(janitor)
library(palmerpenguins)
```

```{r}
options(scipen=999) #cancels the use of scientific notation for the session
```

## Data
**Database of vertebrate home range sizes.**  
Reference: Tamburello N, Cote IM, Dulvy NK (2015) Energy and the scaling of animal space use. The American Naturalist 186(2):196-211. http://dx.doi.org/10.1086/682070.  
Data: http://datadryad.org/resource/doi:10.5061/dryad.q5j65/1  
```{r message=FALSE, warning=FALSE}
homerange <- read_csv("data/Tamburelloetal_HomeRangeDatabase.csv", na = c("", "NA", "\\")) %>% clean_names()
```

## Aesthetics
There are many options to create nice plots in `ggplot`. One useful trick is to store the plot as a new object and then experiment with geom's and aesthetics. Let's setup a plot that compares `log10_mass` and `log10_hra.` Notice that we are not specifying a geom.
```{r}
p <- homerange %>%
  ggplot(aes(x=log10_mass, y= log10_hra))
```

Play with point size by adjusting the `size` argument.
```{r}
p+geom_point(size=2.25) #increases the size of the points, but if make it too big = overplotting
```
```{r}
p+geom_jitter(size = 3) #is geom_point but introduces random noise that can help
```


We can color the points by a categorical variable.
```{r}
p+geom_point(aes(color=thermoregulation), size = 1.5)
```

We can also map shapes to another categorical variable.
```{r}
p+geom_point(aes(shape=thermoregulation, color=thermoregulation), size = 2) #can change shape of one of the variables
```

What about just filling in with a color preference or size?
```{r}
p+geom_point(size = 3, color = "pink", alpha = 0.8, shape = 24, fill = "deeppink3") #alpha controls transparency, can also help with overplotting if the sizes are big
```

```{r}
colors()
```

```{r}
# Plot all available point shapes
df <- data.frame(x = 1:25, y = rep(1, 25), shape = 0:24)

ggplot(df, aes(x, y)) +
  geom_point(aes(shape = factor(shape)), size = 5, fill = "lightblue") +
  scale_shape_manual(values = 0:24) +
  theme_void() +
  theme(legend.position = "none") +
  geom_text(aes(label = shape), vjust = -1, size = 5)
```

## Barplots and multiple variables
At this point you should be comfortable building bar plots that show counts of observations using `geom_bar()`. Last time we explored the `fill` option as a way to bring color to the plot; i.e. we filled by the same variable that we were plotting. What happens when we fill by a different categorical variable?  

Let's start by counting how many observations we have in each taxonomic group.
```{r}
homerange %>%
count(taxon, sort=T)
```

Now let's make a bar plot of these data.
```{r}
homerange %>%
ggplot(aes(x=taxon)) +
  geom_bar(fill = "blue")+
  coord_flip()+
  labs(title="Observations by Taxon", x="Taxonomic Group", y= NULL) #takes away y axis label
```

By specifying `fill=trophic.guild` we build a stacked bar plot that shows the proportion of a given taxonomic group that is an herbivore or carnivore.
```{r}
homerange %>%
ggplot(aes(x=taxon, fill = trophic_guild)) +
  geom_bar()+
  coord_flip()+
  labs(title="Observations by Taxon", x="Taxonomic Group", y= NULL)
```

We can also have counts of each trophic guild within taxonomic group shown side-by-side by specifying `position="dodge"`.
```{r}
homerange %>%
ggplot(aes(x=taxon, fill = trophic_guild)) +
  geom_bar(position = "dodge")+
  coord_flip()+
  labs(title="Observations by Taxon", x="Taxonomic Group", y= NULL)
```

Here is the same plot oriented vertically.
```{r}
homerange %>%
ggplot(aes(x=taxon, fill = trophic_guild)) +
  geom_bar(position = "dodge")+
  labs(title="Observations by Taxon", x="Taxonomic Group", y= NULL)
```

```{r}
homerange %>%
ggplot(aes(x=taxon, fill = trophic_guild)) +
  geom_bar(position = "dodge")+
  theme(axis.text.x = element_text(angle=60, hjust = 1)) + #angle the text so it doesnt overlap
  labs(title="Observations by Taxon", x="Taxonomic Group", y= NULL)
```


We can also scale all bars to a percentage.
```{r}
homerange %>%
  ggplot(aes(x=taxon, fill=trophic_guild)) + 
  geom_bar(position=position_fill()) +
  scale_y_continuous(labels=scales::percent) +
  coord_flip()
```

## Practice
For this practice, let's use the [palmerpenguins](https://allisonhorst.github.io/palmerpenguins/articles/intro.html) data.  

1. Make a bar plot that shows counts of individuals by island. Fill by species, and try both a stacked bar plot and `position="dodge"`.
```{r}
names(penguins)
```

```{r}
penguins %>%
  ggplot(aes(x=island, fill=species)) +
  geom_bar(position = "dodge") + 
  labs(title="Individuals by Island", x="Island", y= NULL)
```

```{r}
penguins %>%
  ggplot(aes(x=island, fill=species)) +
  geom_bar() +
  labs(title="Individuals by Island", x="Island", y= NULL)
```

2. Make another bar plot that shows the number of individuals by sex on each island?
```{r}
penguins %>%
  na.omit() %>% #gets rid of NAs
  ggplot(aes(x=island, fill = sex)) +
  geom_bar(position = "dodge")
  
```

## Using `group`
In addition to `fill`, `group` is an aesthetic that accomplishes the same function but does not add color. It groups data for plotting.

Here is a box plot that shows `log10.mass` by taxonomic `class.`
```{r}
homerange %>%
  ggplot(aes(x=class, y=log10_mass))+
  geom_boxplot()
```

I use `group` to make individual box plots for each taxon.
```{r}
homerange %>%
  ggplot(aes(x=class, y=log10_mass, group = taxon))+
  geom_boxplot()
```

I can also use `fill` to associate the different taxa with a color coded key.
```{r}
homerange %>%
  ggplot(aes(x=class, y=log10_mass, fill = taxon))+
  geom_boxplot()
```

## Wrap-up  
Please review the learning goals and be sure to use the code here as a reference when completing the homework.    

-->[Home](https://jmledford3115.github.io/datascibiol/)