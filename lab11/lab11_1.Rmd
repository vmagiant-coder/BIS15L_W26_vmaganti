---
title: "Lab 11.1"
output:
  html_document:
    theme: spacelab
    toc: yes
    toc_float: yes
  pdf_document:
    toc: yes
---

## Learning Goals
*At the end of this exercise, you will be able to:*    
1. Build line plots, histograms, and density plots.  
2. Adjust colors using R's built-in color options.  
3. Create new categories with `case_when()` and use those categories to build plots.  

## Resources
- [ggplot2 cheatsheet](https://rstudio.github.io/cheatsheets/data-visualization.pdf)  
- [ggplot themes](https://ggplot2.tidyverse.org/reference/ggtheme.html)  
- [Rebecca Barter `ggplot` Tutorial](http://www.rebeccabarter.com/blog/2017-11-17-ggplot2_tutorial/)  
- [R Color Brewer](http://colorbrewer2.org/#type=sequential&scheme=BuGn&n=3)  
- [Gapminder](https://www.gapminder.org/data/)  

## Load the libraries
```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(janitor)
```

```{r}
options(scipen=999) #cancels the use of scientific notation for the session
```

## Data
For these exercises, we are going to use [Gapminder](https://www.gapminder.org/data/) data on population (pop), GDP per capita (gdp), and life expectancy (lex). These data were downloaded and compiled using the `gapminder_compile.Rmd` script in the data folder.
```{r message=FALSE, warning=FALSE}
gap <- read_csv("data/gapminder.csv") %>% clean_names()
```

## Line plots
Line plots are great when you need to show changes over time. Let's see if we can find downturns in the US economy between 2000-2025.  

Let's start by making a clear x and y so we know what we are going to plot.
```{r}
gap %>%
  filter((year>=2000 & year <=2025) & country == "USA") %>%
  ggplot(aes(x=year, y=gdp)) +
  geom_line(color="purple") +
  geom_point(shape=5) +
  scale_x_continuous(breaks=2000:2025, minor_breaks = NULL) +
  theme(axis.text.x = element_text(angle=60, hjust=1)) +
  labs(title="GDP per Capita in the USA, 2000-2025",
       x="Year",
       y="GDP")
```

```{r}
gap %>%
  filter((year>=2000 & year <=2025) & country == "USA") %>%
  ggplot(aes(x=year, y=gdp)) +
  geom_line(color="purple") +
  geom_point(shape=5) +
  scale_x_continuous(breaks=seq(2000, 2025, by = 5), minor_breaks = NULL) +
  theme(axis.text.x = element_text(angle=60, hjust=1)) +
  labs(title="GDP per Capita in the USA, 2000-2025",
       x="Year",
       y="GDP")
```

## Histograms
Histograms show the distribution of continuous variables. As students, you have seen histograms of grade distributions. A histogram `bins` the data and you specify the number of bins that encompass a range of observations. For something like grades, this is easy because the number of bins corresponds to the grades A-F. By default, R uses a formula to calculate the number of bins but some adjustment may be required.  

What was the distribution of life expectancy in 1935?
```{r}
gap %>%
  filter(year==1935) %>%
  ggplot(aes(x=lex)) +
  geom_histogram()
```

Let's rebuild the histogram, but this time we will specify the color and fill. Do a little experimentation on your own with the different colors.
```{r}
gap %>%
  filter(year==1935) %>%
  ggplot(aes(x=lex)) +
  geom_histogram(color = "turquoise4", fill = "turquoise", bins=30) +
  labs(title="Distribution of Life Expectancy")
```

## Density plots  
Density plots are similar to histograms but they use a smoothing function to make the distribution more even and clean looking. They do not use bins.
```{r}
gap %>%
  filter(year==1935) %>%
  ggplot(aes(x=lex)) +
  geom_density(color = "turquoise4", fill = "turquoise", alpha=0.6) +
  labs(title="Distribution of Life Expectancy")
#use bar plots for counts of a categorical variable, not the distribution of a variable
```

I like to see both the histogram and the density curve so I often plot them together. Note that I assign the density plot a different color.
```{r}
gap %>%
  filter(year==1935) %>%
  ggplot(aes(x=lex)) +
  geom_histogram(aes(y=after_stat(density)), color="deeppink", fill="pink1") +
  geom_density(color = "purple3") +
  labs(title="Distribution of Life Expectancy")
```

## Practice
1. Antibiotics became widely available in the 1940's. How did life expectancy change between 1930 and 1950? Let's plot the density curves for both years on the same plot. Use the `fill` aesthetic to differentiate the two years.
```{r warning=FALSE}
gap %>%
  filter(year %in% c(1930, 1950)) %>%
  mutate(year=factor(year)) %>%
  ggplot(aes(x=lex, color = year, fill = year)) +
  geom_density(alpha = 0.6) +
  labs(title="Distribution of Life Expectancy, 1930 and 1950",
       x="Life Expectancy",
       y= NULL,
       color= "Year",
       fill = "Year")
```

## Create Categories with mutate and case_when()
`case_when()` is a very handy function from `dplyr` which allows us to calculate a new variable from other variables. We use `case_when()` within `mutate()` to do this.`case_when()` allows us to specify multiple conditions.  

The approximate World Bank Income Categories are:  
- Low income: $1,100 or less
- Lower middle income: $1,100 to $4,500
- Upper middle income: $4,500 to $13,900
- High income: $13,900 or more

Let's use `case_when()` to create a new column `income_category` that categorizes countries into these income categories based on their GDP per capita in 2000.
```{r}
income_cat2000 <- gap %>%
  filter(year==2000) %>%
  mutate(income_category=case_when(gdp<=1100 ~ "low",
                                   gdp>1100 & gdp<=4500 ~ "low_middle",
                                   gdp>4500 & gdp<= 13900 ~ "upper_middle",
                                 gdp>13900 ~ "high")) %>%
  select(country, gdp, income_category) %>%
  mutate(income_category = factor(income_category,
                                  levels=c("low",
                                           "low_middle",
                                           "upper_middle",
                                           "high")))
income_cat2000
```

## Practice
1. How many countries are in each of the World Bank Income Categories as of the year 2000?
```{r}
income_cat2000 %>%
  group_by(income_category) %>%
  summarize(count=n())
```

2. Make a bar plot showing the number of countries in each income category in the year 2000.
```{r}
income_cat2000 %>%
  drop_na(income_category) %>% #get rid of NA's
  ggplot(aes(x=income_category, fill= income_category)) +
  geom_bar()+
  labs(title="Countries in WB Income Categories",
       x="Income Category",
       y=NULL) +
  theme(legend.position = "none") #remove the legend
```

## That's it! Let's take a break!  

-->[Home](https://jmledford3115.github.io/datascibiol/)