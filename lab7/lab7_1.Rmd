---
title: "Lab 7"
date: "`r Sys.Date()`"
output:
  html_document:
    theme: spacelab
    toc: yes
    toc_float: yes
  pdf_document:
    toc: yes
---

## Learning Goals
*At the end of this exercise, you will be able to:*    
1. Produce statistical summaries using `summarize()`.  
4. Produce counts using `count()`.  

## Load the libraries
```{r message=FALSE, warning=FALSE}
library("tidyverse")
library("janitor")
```

## Data
For this lab, we will use the built-in data on mammal sleep patterns, `msleep`. From: _V. M. Savage and G. B. West. A quantitative, theoretical framework for understanding mammalian sleep. Proceedings of the National Academy of Sciences, 104 (3):1051-1056, 2007_.

## Summary statistics
When first exploring data, it is often a good idea to produce some basic summary statistics. This can help you identify potential problems with the data (e.g., outliers, missing values, skew) as well as get a general sense of the distribution of values for a given variable. So far, you have learned to calculate summary statistics using _base R_ functions such as `mean()`, `sd()`, `min()`, and `max()`.  

```{r}
summary(msleep)
```


## Practice
1. Calculate the mean body weight of large and small mammals in msleep. Large mammals have a body weight greater than 150, while small mammals have a body weight less than 10. I did large mammals for you as an example.  
```{r}
large <- msleep %>% 
  filter(bodywt > 150) %>% 
  arrange(desc(bodywt))
large
```

```{r}
small <- msleep %>%
  filter(bodywt < 10) %>%
arrange(desc(bodywt))
small
```

```{r}
mean(large$bodywt)
```

```{r}
mean(small$bodywt)
```

## `summarize()`
Fortunately, dplyr has some functions that make producing summary statistics easier. The verb `summarize()` produces summary statistics for a given variable in a data frame. Let's try the examples above using `summarize()`. 

Large mammals
```{r}
msleep %>%
  filter(bodywt > 150) %>%
  summarize(mean_bodywt_lg=mean(bodywt))
```

Small mammals
```{r}
msleep %>%
  filter(bodywt < 10) %>%
  summarize(mean_bodywt_sm=mean(bodywt))
```

You can also combine functions to make summaries for multiple variables.
```{r}
msleep %>%
  filter(bodywt > 150) %>%
  summarize(mean_bodywt_lg=mean(bodywt),
            min_bodywt_lg=min(bodywt),
            max_bodywt_lg=max(bodywt),
            sd_bodywt_lg=sd(bodywt),
            total=n())
```

Maybe you want to summarize all of the numeric variables in the data frame. You can use the `where()` function to select only the numeric variables.
```{r}
msleep %>%
  select(where(is.numeric)) %>%
  summarize_all(mean)
```

Don't forget to remove NA's.
```{r}
msleep %>%
  select(where(is.numeric)) %>%
  summarize_all(mean, na.rm = T)
#removes the NA values when finding the mean statistically
```

This is a little more efficient.
```{r}
msleep %>%
  summarize(across(where(is.numeric), 
                   ~mean(.x, na.rm = T)))
#also works for removing NAs
#.x means for every cell
```

## Practice
1. What is the mean, min, and max `bodywt` for the taxonomic order Primates? Provide the total number of observations.
```{r}
names(msleep)
```

```{r}
msleep %>%
  filter(order=="Primates") %>%
  summarize(mean_bw_prim=mean(bodywt),
            max_bw_prim=max(bodywt),
            min_bw_prim=min(bodywt))
```


`n_distinct()` is a handy way of cleanly presenting the number of distinct observations. Notice that there are 9 genera with over 100 in body weight.
```{r}
msleep %>%
  filter(bodywt>100) %>%
  distinct()
#distinct tells you that there are (ex. 11) distinct observations in full data frame
```

Here we show the number of distinct genera over 100 in body weight.
```{r}
msleep %>%
  filter(bodywt>100) %>%
  summarize(n_genera=n_distinct(genus))
#n_distinct to know number of distinct (ex. genera (n_distinct(genus))), and this gives you 9 out of the 11 distinct in the whole dataframe
```

Not to be confused with n(), which counts the total number of observations.
```{r}
msleep %>%
  filter(bodywt>100) %>%
  summarize(total=n())
```

```{r}

```

`pull()` is another useful verb that extracts a single column from a data frame as a vector.
```{r}
msleep %>%
  filter(bodywt>100) %>%
  distinct() %>%
  pull(genus)
#distinct + pull gives you a vector
```

## Practice
1. How many genera are represented in the msleep data frame?
```{r}
msleep %>%
  summarize(n_genera=n_distinct(genus))
```

## Counts
Although `summarize()` is helpful, oftentimes we are only interested in counts. The [janitor package](https://garthtarr.github.io/meatR/janitor.html) does a lot with counts, but there are also functions that are part of dplyr that are useful.  

For example, if we wanted to count the number of observations for each `vore` category in the `msleep` data frame we could do the following:
```{r}
msleep %>%
  count(vore)
#can use count(vore, sort = T)
```

```{r}
msleep %>%
  count(vore) %>%
  ggplot(aes(x=vore, y=n)) +
  geom_col(aes(fill=vore))
#use geom_col when have x and y and need a column graph
```

You can even combine multiple variables to get counts. For example, if we wanted to count the number of observations for each `vore` category within each `order` category we could do the following:
```{r}
msleep %>%
  count(vore, order)
```

The tabyl() function from the janitor package is also very useful for producing counts and percentages.  
```{r}
msleep %>%
  tabyl(vore)
```

## Practice
1. In the taxonomic order Carnivora, count the number of observations for each conservation status.
```{r}
names(msleep)
```

```{r}
msleep %>%
  filter(order=="Carnivora") %>%
  count(conservation)
```


2. Among herbivores, which order is most represented? Return the top 5 orders with counts, sorted in descending order.
```{r}
msleep %>%
  filter(vore =="herbi") %>%
  count(order, sort = T)%>%
  arrange(desc(order)) %>%
  slice_max(order, n = 5)
```

-->[Home](https://jmledford3115.github.io/datascibiol/)  